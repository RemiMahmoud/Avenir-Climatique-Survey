---
title: "0 - Set data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup, message=FALSE, warning=FALSE}
# packages
library(readr)
library(lubridate)
library(tidyverse)
library(knitr)
library(readxl)
library(googledrive)

# path
opts_knit$set(root.dir = normalizePath('../'))

opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
registerDoMC(cores=8)
theme_set(theme_bw())

options(tibble.print_max = 80, tibble.print_min = 80)

"%ni%" <- Negate("%in%")


set_NA <- `is.na<-` #Function to add NAs columns

```



```{r}
id <- drive_find(type = 'spreadsheet') %>% filter(str_detect(name, "Formulaire")) %>% select(id)

drive_get(id = as_id(id$id))
drive_download(file = as_id(id$id), path = "data/ac_survey.xlsx", overwrite = TRUE)

```

```{r}

data_raw <- read_xlsx("data/ac_survey.xlsx")
data_raw %>% head
```


```{r}

tab_columns <- data_raw %>%
  colnames %>%
  enframe(name  = NULL) %>% 
  mutate(id = paste("Q",1:n(), sep = "")) %>% 
  rename(question = value) 

data_work <- data_raw %>% 
  rename_all(vars(paste("Q",1:ncol(data_raw),sep = "")))

```


```{r}

Q3_options <- c("Conférences", "vulgarisation", "Livres", "Vidéos", "presse", "Publications scientifiques")
Q9_options <- c("pouvoir d'achat", "potentiel d'action", "climatosceptiques", "niveau de vie si cette baisse s'opère pour les autres également", "niveau de vie même si cette baisse ne s'opère pas pour les autres", "démocratique", "hiérarchiser les problèmes", "adaptabilité de l'homme")
Q10_options <- c("mode de vie", "esprit sceptique","complotiste", "opinion", "stupidité", "dogme religieux", "éducation")
Q16_options <- c("réseaux sociaux", "références directement", "profil bas", "l'émotion", "conférence")
Q28_options <- c("Académicien", "Coach", "Ancien Académicien")
Q25_options <- c("Local", "Bio", "Végétalien", "Végétarien", "Flexitarien", "pas trop attention")


```

```{r}
 data_work %>% select(Q27,Q29,Q30) %>% table
#Remove useless columns

data_work <- data_work  %>% 
  select(-c(Q27, Q29,Q30)) 


```

```{r}

for (var in c(Q3_options)) {
 data_work[[var]] <- grepl(var, data_work$Q3)
}

for (var in Q9_options) {
 data_work[[var]] <- grepl(var, data_work$Q9)
}

for (var in Q16_options) {
 data_work[[var]] <- grepl(var, data_work$Q16)
}

for (var in Q28_options) {
 data_work[[var]] <- grepl(var, data_work$Q28,fixed = TRUE)
}

for (var in Q25_options) {
 data_work[[var]] <- grepl(var, data_work$Q25)
}


```

